<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <title>L2 Phaser RPG</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <link rel="stylesheet" href="preEntry.css">

    <style>
      :root {
        --app-height: 100vh;
      }

      html, body {
        margin: 0;
        padding: 0;
        width: 100%;
        height: 100%;
        background: #0a0a12;
        overflow: hidden !important;
        overscroll-behavior: none;
      }

      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #f8f9ff;
      }

      #game-container {
        position: fixed;
        inset: 0;
        margin: auto;
        width: min(100vw, 430px);
        height: min(var(--app-height), 932px);
        background: #0a0a12;
        overflow: hidden;
        touch-action: none;
      }

      @media (max-width: 520px), (pointer: coarse) {
        #game-container {
          width: 100vw;
          height: var(--app-height);
        }
      }

      canvas { display: block; image-rendering: auto; }

      * {
        box-sizing: border-box;
      }

      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: #111320;
      }

      ::-webkit-scrollbar-thumb {
        background: #424767;
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: #5c6188;
      }
    </style>
  </head>
 <body>
  <!-- Pre-Entry Overlay (Loader + Intro) -->
  <div id="preEntry">
    <div id="preLoader">
      <div class="pre-logo">POCKET LINEAGE</div>
      <div class="pre-decor-line"></div>
      <div class="pre-progress-container">
        <div class="pre-progress-bar">
          <div class="pre-progress-fill"></div>
        </div>
      </div>
      <div class="pre-loading-text">Загрузка...</div>
    </div>
    <div id="preIntro">
      <div class="pre-intro-title">Ты стоишь у врат<br>Talking Island</div>
      <button class="pre-intro-btn">НАЧАТЬ ПУТЬ</button>
      <div class="pre-intro-hint">Прогресс сохраняется автоматически</div>
    </div>
  </div>

  <div id="game-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/dist/phaser.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.1/plugins/spine4.1/dist/SpinePlugin.js"></script>

<!-- PRE-ENTRY -->
<script src="preEntry.js"></script>

<!-- STATE -->
<script src="state/uiConstants.js"></script>
<script src="state/heroState.js"></script>
<script src="state/itemSystem.js"></script>
<script src="state/saveSystem.js"></script>
<script src="state/statSystem.js"></script>
<script src="state/tickSystem.js"></script>
<script src="state/worldState.js"></script>
<script src="state/mercenarySystem.js"></script>
<script src="state/autoHuntSystem.js"></script>
<script src="state/overdriveSystem.js"></script>
<script src="state/economySystem.js"></script>
<script src="state/combatSystem.js"></script>
<script src="state/progressionSystem.js"></script>
<script src="state/arenaSystem.js"></script>
<script src="state/dungeonSystem.js"></script>
<script src="state/skillSystem.js"></script>
<script src="state/locationSystem.js"></script>
<script src="state/uiSystem.js"></script>
<script src="state/spSystem.js"></script>
<script src="state/professionSystem.js"></script>
<script src="state/petSystem.js"></script>
<script src="state/restSystem.js"></script>
<script src="state/forgeSystem.js"></script>
<script src="state/uiLayout.js"></script>
<script src="state/runnerBattle.js"></script>

<!-- UI PANELS -->
<script src="ui/inventoryPanel.js"></script>
<script src="ui/statsPanel.js"></script>
<script src="ui/forgePanel.js"></script>
<script src="ui/questsPanel.js"></script>
<script src="ui/shopPanel.js"></script>
<script src="ui/arenaPanel.js"></script>
<script src="ui/dungeonPanel.js"></script>
<script src="ui/mapPanel.js"></script>
<script src="ui/selectionScreen.js"></script>
<script src="ui/characterCreation.js"></script>
<script src="ui/skillsPanel.js"></script>

<!-- MAIN -->
<script src="game.js"></script>

<!-- Debug overlay - visible on screen -->
<div id="debug-overlay" style="
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  background: red;
  color: white;
  font-family: monospace;
  font-size: 10px;
  padding: 5px;
  z-index: 999999;
  text-align: center;
  pointer-events: none;
">LOADING DEBUG...</div>

<script>
  const debugEl = document.getElementById('debug-overlay');
  const logs = [];

  function debugLog(msg) {
    logs.push(msg);
    if (logs.length > 8) logs.shift();
    debugEl.innerHTML = logs.join(' | ');
    console.log(msg);
  }

  const tg = window.Telegram?.WebApp;
  const plat = tg?.platform || 'web';
  const dpr = (window.devicePixelRatio || 1).toFixed(1);

  debugLog('P:' + plat);
  debugLog('DPR:' + dpr);
  debugLog('SCR:' + window.innerWidth + 'x' + window.innerHeight);

  setTimeout(() => {
    const c = document.querySelector('canvas');
    if (c) {
      debugLog('BACK:' + c.width + 'x' + c.height);
      const r = c.getBoundingClientRect();
      debugLog('CSS:' + r.width.toFixed(0) + 'x' + r.height.toFixed(0));
    }
  }, 2000);
</script>

<!-- Eruda console -->
<script src="https://cdn.jsdelivr.net/npm/eruda"></script>
<script>eruda.init();</script>

</body>
</html>
