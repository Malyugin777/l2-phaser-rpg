<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Sprite Test</title>
  <style>
    body {
      background: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      font-family: Arial, sans-serif;
      color: white;
    }
    #game-container {
      border: 2px solid #666;
      margin: 20px;
    }
    .controls {
      display: flex;
      gap: 10px;
      margin: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 10px 20px;
      font-size: 14px;
      cursor: pointer;
      background: #555;
      color: white;
      border: 1px solid #888;
      border-radius: 4px;
    }
    button:hover { background: #666; }
    button.active { background: #4a4; border-color: #6c6; }
    .info {
      background: #444;
      padding: 15px;
      border-radius: 8px;
      margin: 10px;
      max-width: 600px;
    }
    input[type="range"] {
      width: 150px;
    }
    label {
      display: flex;
      align-items: center;
      gap: 10px;
    }
  </style>
</head>
<body>
  <h1>üßô Mage Sprite Test ‚Äî All Animations</h1>
  
  <div class="info">
    <p><strong>–§–∞–π–ª—ã:</strong></p>
    <ul>
      <li><code>hero_idle.png</code> ‚Äî 2560√ó2560, 5√ó5=25 –∫–∞–¥—Ä–æ–≤, 512√ó512</li>
      <li><code>hero_run.png</code> ‚Äî 2560√ó2560, 5√ó5=25 –∫–∞–¥—Ä–æ–≤, 512√ó512</li>
      <li><code>hero_walk.png</code> ‚Äî 3072√ó3136, 28 –∫–∞–¥—Ä–æ–≤, 768√ó448</li>
      <li><code>hero_cast.png</code> ‚Äî 3072√ó3584, 16 –∫–∞–¥—Ä–æ–≤, 768√ó896</li>
    </ul>
  </div>
  
  <div class="controls">
    <button id="btnPlay" class="active">‚ñ∂ Play</button>
    <button id="btnPause">‚è∏ Pause</button>
    <button id="btnStep">‚è≠ Step</button>
    <label>
      Speed: <input type="range" id="speedSlider" min="4" max="24" value="12">
      <span id="speedValue">12 fps</span>
    </label>
    <label>
      Scale: <input type="range" id="scaleSlider" min="0.1" max="1.5" step="0.05" value="0.35">
      <span id="scaleValue">0.35x</span>
    </label>
  </div>
  
  <div class="controls">
    <button id="btnIdle12" class="active">üßç Idle 12f</button>
    <button id="btnIdle36">üßç Idle 25f</button>
    <button id="btnWalk10">üö∂ Walk 10f</button>
    <button id="btnRun10">üèÉ Run 10f</button>
    <button id="btnCast8">‚ú® Cast 8f</button>
    <button id="btnCast16">‚ú® Cast 16f</button>
  </div>
  
  <div id="game-container"></div>
  
  <div class="info" id="frameInfo">
    Current frame: 0 | Total: 28
  </div>

  <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.min.js"></script>
  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–ø—Ä–∞–π—Ç–∞
    const SPRITE_CONFIG = {
      cols: 4,
      rows: 7,
      totalFrames: 28,
      // –†–∞–∑–º–µ—Ä—ã –∫–∞–¥—Ä–∞: 3072/4 = 768, 3136/7 = 448
      frameWidth: 768,
      frameHeight: 448
    };
    
    let currentAnim = 'walk_10';
    let heroSprite = null;
    let isPaused = false;
    
    class TestScene extends Phaser.Scene {
      constructor() {
        super({ key: 'TestScene' });
      }
      
      preload() {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø—Ä–∞–π—Ç-–ª–∏—Å—Ç—ã
        this.load.spritesheet('hero_walk', './assets/hero/hero_walk.png', {
          frameWidth: 768,
          frameHeight: 448  // 3072√ó3136, 4√ó7=28 –∫–∞–¥—Ä–æ–≤
        });
        this.load.spritesheet('hero_run', './assets/hero/hero_run.png', {
          frameWidth: 512,
          frameHeight: 512  // 2560√ó2560, 5√ó5=25 –∫–∞–¥—Ä–æ–≤
        });
        this.load.spritesheet('hero_cast', './assets/hero/hero_cast.png', {
          frameWidth: 768,
          frameHeight: 896  // 3072√ó3584, 4√ó4=16 –∫–∞–¥—Ä–æ–≤
        });
        this.load.spritesheet('hero_idle', './assets/hero/hero_idle.png', {
          frameWidth: 512,
          frameHeight: 512  // 2560√ó2560, 5√ó5=25 –∫–∞–¥—Ä–æ–≤
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–∫–∏ –∑–∞–≥—Ä—É–∑–∫–∏
        this.load.on('loaderror', (file) => {
          console.error('Failed to load:', file.src);
          document.getElementById('frameInfo').innerHTML = 
            '<span style="color: #f66;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏! –ü—Ä–æ–≤–µ—Ä—å –ø—É—Ç—å: ' + file.src + '</span>';
        });
      }
      
      create() {
        const centerX = this.scale.width / 2;
        const centerY = this.scale.height / 2;
        
        // –§–æ–Ω-—Å–µ—Ç–∫–∞ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏
        this.add.grid(centerX, centerY, 800, 600, 50, 50, 0x222222, 1, 0x444444, 0.5);
        
        // –°–æ–∑–¥–∞—ë–º –∞–Ω–∏–º–∞—Ü–∏–∏
        this.createAnimations();
        
        // –°–æ–∑–¥–∞—ë–º —Å–ø—Ä–∞–π—Ç
        heroSprite = this.add.sprite(centerX, centerY, 'hero_idle');
        heroSprite.setScale(0.35); // Idle 512√ó512
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
        heroSprite.play('idle_12');
        currentAnim = 'idle_12';
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∫–∞–¥—Ä–µ
        this.time.addEvent({
          delay: 100,
          loop: true,
          callback: () => {
            if (heroSprite && heroSprite.anims) {
              const frame = heroSprite.anims.currentFrame;
              if (frame) {
                document.getElementById('frameInfo').textContent = 
                  `Current frame: ${frame.index} | Animation: ${currentAnim} | Total frames in anim: ${heroSprite.anims.currentAnim?.frames.length || 0}`;
              }
            }
          }
        });
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        this.setupControls();
      }
      
      createAnimations() {
        const frames10 = [0, 3, 6, 9, 12, 15, 18, 21, 24, 27];
        
        // WALK –∞–Ω–∏–º–∞—Ü–∏–∏ (28 –∫–∞–¥—Ä–æ–≤)
        this.anims.create({
          key: 'walk_28',
          frames: this.anims.generateFrameNumbers('hero_walk', { start: 0, end: 27 }),
          frameRate: 12,
          repeat: -1
        });
        this.anims.create({
          key: 'walk_10',
          frames: frames10.map(i => ({ key: 'hero_walk', frame: i })),
          frameRate: 12,
          repeat: -1
        });
        
        // RUN –∞–Ω–∏–º–∞—Ü–∏–∏ (25 –∫–∞–¥—Ä–æ–≤)
        this.anims.create({
          key: 'run_28',
          frames: this.anims.generateFrameNumbers('hero_run', { start: 0, end: 24 }),
          frameRate: 14,
          repeat: -1
        });
        this.anims.create({
          key: 'run_10',
          frames: [0, 2, 5, 7, 10, 12, 15, 17, 20, 22].map(i => ({ key: 'hero_run', frame: i })),
          frameRate: 12,
          repeat: -1
        });
        
        // CAST –∞–Ω–∏–º–∞—Ü–∏–∏ (16 –∫–∞–¥—Ä–æ–≤)
        this.anims.create({
          key: 'cast_16',
          frames: this.anims.generateFrameNumbers('hero_cast', { start: 0, end: 15 }),
          frameRate: 12,
          repeat: -1
        });
        this.anims.create({
          key: 'cast_8',
          frames: [0, 2, 4, 6, 8, 10, 12, 14].map(i => ({ key: 'hero_cast', frame: i })),
          frameRate: 10,
          repeat: -1
        });
        
        // IDLE –∞–Ω–∏–º–∞—Ü–∏–∏ (25 –∫–∞–¥—Ä–æ–≤ –∏–∑ Ludo)
        this.anims.create({
          key: 'idle_36',
          frames: this.anims.generateFrameNumbers('hero_idle', { start: 0, end: 24 }),
          frameRate: 12,
          repeat: -1
        });
        this.anims.create({
          key: 'idle_12',
          frames: [0, 2, 4, 6, 8, 10, 12, 14, 16, 18, 20, 22].map(i => ({ key: 'hero_idle', frame: i })),
          frameRate: 10,
          repeat: -1
        });
      }
      
      setupControls() {
        // Play
        document.getElementById('btnPlay').onclick = () => {
          if (heroSprite) {
            heroSprite.anims.resume();
            isPaused = false;
            document.getElementById('btnPlay').classList.add('active');
            document.getElementById('btnPause').classList.remove('active');
          }
        };
        
        // Pause
        document.getElementById('btnPause').onclick = () => {
          if (heroSprite) {
            heroSprite.anims.pause();
            isPaused = true;
            document.getElementById('btnPause').classList.add('active');
            document.getElementById('btnPlay').classList.remove('active');
          }
        };
        
        // Step
        document.getElementById('btnStep').onclick = () => {
          if (heroSprite && heroSprite.anims.currentAnim) {
            heroSprite.anims.pause();
            isPaused = true;
            const frames = heroSprite.anims.currentAnim.frames;
            let nextIndex = (heroSprite.anims.currentFrame.index + 1) % frames.length;
            heroSprite.anims.setCurrentFrame(frames[nextIndex]);
            document.getElementById('btnPause').classList.add('active');
            document.getElementById('btnPlay').classList.remove('active');
          }
        };
        
        // Speed slider
        document.getElementById('speedSlider').oninput = (e) => {
          const fps = parseInt(e.target.value);
          document.getElementById('speedValue').textContent = fps + ' fps';
          if (heroSprite && heroSprite.anims.currentAnim) {
            heroSprite.anims.currentAnim.frameRate = fps;
            heroSprite.anims.msPerFrame = 1000 / fps;
          }
        };
        
        // Scale slider
        document.getElementById('scaleSlider').oninput = (e) => {
          const scale = parseFloat(e.target.value);
          document.getElementById('scaleValue').textContent = scale.toFixed(1) + 'x';
          if (heroSprite) {
            heroSprite.setScale(scale);
          }
        };
        
        // Animation buttons
        const animButtons = [
          { id: 'btnIdle12', anim: 'idle_12' },
          { id: 'btnIdle36', anim: 'idle_36' },
          { id: 'btnWalk10', anim: 'walk_10' },
          { id: 'btnRun10', anim: 'run_10' },
          { id: 'btnCast8', anim: 'cast_8' },
          { id: 'btnCast16', anim: 'cast_16' }
        ];
        
        animButtons.forEach(btn => {
          document.getElementById(btn.id).onclick = () => {
            currentAnim = btn.anim;
            if (heroSprite) {
              heroSprite.play(btn.anim);
              if (isPaused) heroSprite.anims.pause();
            }
            // Update active state
            animButtons.forEach(b => {
              document.getElementById(b.id).classList.remove('active');
            });
            document.getElementById(btn.id).classList.add('active');
          };
        });
      }
    }
    
    // –ó–∞–ø—É—Å–∫ Phaser
    const config = {
      type: Phaser.AUTO,
      width: 800,
      height: 500,
      parent: 'game-container',
      backgroundColor: '#1a1a2e',
      scene: TestScene,
      pixelArt: false
    };
    
    const game = new Phaser.Game(config);
  </script>
</body>
</html>
